@class EDThreadScopeManager, EMBlockedSenderManager, EDMessagePersistence, NSString, NSMutableSet, NSMutableArray, EDPersistenceHookRegistry, EFSQLTableSchema, NSObject, EDPersistenceDatabase, EFDebouncer;
@protocol OS_os_log, EMVIPManager, EFScheduler;

@interface EDThreadPersistence : NSObject <EDDatabaseChangeHookResponder, EDAccountChangeHookResponder, EDMailboxChangeHookResponder, EDMessageChangeHookResponder, EDProtectedDataReconciliationHookResponder, EDThreadScopeManagerDataSource, EFSignpostable, EDPersistenceDatabaseSchemaProvider, EFLoggable> {
    NSMutableSet *_threadObjectIDsToRecompute;
    struct os_unfair_lock_s { unsigned int _os_unfair_lock_opaque; } _threadRecomputationLock;
    NSMutableArray *_migratingThreadScopes;
    struct os_unfair_lock_s { unsigned int _os_unfair_lock_opaque; } _migratingThreadScopesLock;
}

@property (class, readonly, nonatomic) EFSQLTableSchema *threadScopesTableSchema;
@property (class, readonly, nonatomic) EFSQLTableSchema *threadsTableSchema;
@property (class, readonly, nonatomic) EFSQLTableSchema *threadMailboxesTableSchema;
@property (class, readonly, nonatomic) EFSQLTableSchema *threadSendersTableSchema;
@property (class, readonly, nonatomic) EFSQLTableSchema *threadRecipientsTableSchema;
@property (class, readonly) NSObject<OS_os_log> *signpostLog;
@property (class, readonly) NSObject<OS_os_log> *log;

@property (readonly, nonatomic) EDMessagePersistence *messagePersistence;
@property (readonly, nonatomic) EDPersistenceDatabase *database;
@property (readonly, nonatomic) EDPersistenceHookRegistry *hookRegistry;
@property (readonly, nonatomic) id<EMVIPManager> vipManager;
@property (readonly, nonatomic) EMBlockedSenderManager *blockedSenderManager;
@property (readonly, nonatomic) EDThreadScopeManager *threadScopeManager;
@property (readonly, nonatomic) id<EFScheduler> consistencyCheckScheduler;
@property (retain, nonatomic) id<EFScheduler> threadRecomputationScheduler;
@property (retain, nonatomic) EFDebouncer *threadRecomputationDebouncer;
@property (readonly) unsigned long long hash;
@property (readonly) Class superclass;
@property (readonly, copy) NSString *description;
@property (readonly, copy) NSString *debugDescription;
@property (readonly) unsigned long long signpostID;

+ (id)tablesAndForeignKeysToResolve:(id *)a0 associationsToResolve:(id *)a1;

- (id)_persistedMessagesByPossibleThreadScopeForPersistedMessages:(id)a0;
- (BOOL)_deleteSendersFromThreadWithDatabaseID:(id)a0 messageThreadExpression:(id)a1;
- (id)_addressesFromSelectStatement:(id)a0;
- (void)persistenceDidChangeGlobalMessageID:(long long)a0 orConversationID:(long long)a1 message:(id)a2 generationWindow:(id)a3;
- (BOOL)deleteThreadsWithObjectIDs:(id)a0;
- (id)_upsertForThreadsWithThreadScopeDatabaseID:(long long)a0 conversation:(long long)a1;
- (id)_recipientDatabaseIDsAndDatesForWrappedMessages:(id)a0 recipientType:(unsigned long long)a1;
- (BOOL)_updateNewestReadMessageWithWrappedMessage:(id)a0 threadExpression:(id)a1;
- (id)_senderDatabaseIDsAndDatesForWrappedMessages:(id)a0;
- (id)_recipientDatabaseIDsAndDatesForThreadWithObjectID:(id)a0 recipientType:(unsigned long long)a1;
- (void)persistenceIsChangingFlags:(id)a0 messages:(id)a1 generationWindow:(id)a2;
- (id)_updateBasicPropertiesAfterDeleteForThreadObjectID:(id)a0 threadScopeDatabaseID:(long long)a1;
- (void)persistenceIsInitializingDatabaseWithConnection:(id)a0;
- (BOOL)setPriorityForDisplayMessageSenderForThreadObjectID:(id)a0;
- (id)_mailboxesForThreadDatabaseID:(id)a0;
- (void)_iterateWrappedMessagesByConversationForPersistedMessages:(id)a0 block:(id /* block */)a1;
- (void)persistenceDidChangeFlags:(id)a0 messages:(id)a1 generationWindow:(id)a2;
- (void)persistenceDidDeleteAllMessagesInMailboxesWithURLs:(id)a0 generationWindow:(id)a1;
- (void)test_tearDown;
- (BOOL)threadScopeManager:(id)a0 mailboxScopeExists:(id)a1;
- (BOOL)_deleteMailboxesFromWrappedMessages:(id)a0 fromThreadWithDatabaseID:(id)a1 messageThreadExpression:(id)a2;
- (id)threadObjectIDsByNextExistingForThreadObjectIDs:(id)a0 forSortDescriptors:(id)a1 excluding:(id)a2;
- (void)_iterateWrappedMessagesByConversationForPersistedMessages:(id)a0 writeBlock:(id /* block */)a1;
- (void)_persistenceIsDeletingMessages:(id)a0 generationWindow:(id)a1;
- (void)updateLastViewedDateForThreadScope:(id)a0;
- (id)_senderDatabaseIDsAndDatesForMessages:(id)a0;
- (void)_resetThreadScope:(id)a0 withDatabaseID:(id)a1;
- (BOOL)_addThreadScopeToDatabase:(id)a0 needsUpdate:(BOOL)a1 lastViewedDate:(id)a2 updateThreadScopeManager:(BOOL)a3;
- (BOOL)_enumerateThreadObjectIDsForThreadScope:(id)a0 filterClause:(id)a1 sortDescriptors:(id)a2 batchBlock:(id /* block */)a3;
- (id)_threadForWrappedMessages:(id)a0 objectID:(id)a1;
- (BOOL)endMigratingThreadScope:(id)a0;
- (id)_persistenceIsChangingFlags:(id)a0 wrappedMessages:(id)a1 threadObjectID:(id)a2 threadScopeDatabaseID:(long long)a3;
- (id)_filteredPersistedMessagesForPersistedMessages:(id)a0;
- (void)persistenceIsChangingConversationID:(long long)a0 messages:(id)a1 generationWindow:(id)a2;
- (void)_addOrderByToThreadSelect:(id)a0 forSortDescriptors:(id)a1;
- (void)threadScopeManager:(id)a0 gatherStatisticsForThreadScopesWithDatabaseIDs:(id)a1 block:(id /* block */)a2;
- (void)_recomputeThreads;
- (id)_inactiveMailboxDatabaseIDsForMailboxScope:(id)a0 forThreadScopeDatabaseID:(id)a1;
- (BOOL)_isThreadScopePrecomputed:(id)a0 shouldMigrate:(BOOL *)a1;
- (id)_persistedMessagesForMailboxScope:(id)a0 messageExpression:(id)a1;
- (void)_addKeyPathsForBasicPropertiesChangeToKeyPaths:(id)a0;
- (id)_recipientAddressesExpressionForRecipientType:(unsigned long long)a0 messages:(id)a1;
- (id)changeForThreadWithObjectID:(id)a0 changedKeyPaths:(id)a1;
- (void)persistenceDidUpdateProperties:(id)a0 message:(id)a1 generationWindow:(id)a2;
- (id)oldestThreadObjectIDForMailbox:(id)a0 threadScope:(id)a1;
- (void)threadScopeManager:(id)a0 populateThreadScopesWithBlock:(id /* block */)a1;
- (void)_scheduleRecomputationForThread:(id)a0 reason:(id)a1;
- (BOOL)_addThreadScopeToDatabase:(id)a0 withMailboxDatabaseID:(long long)a1 needsUpdate:(BOOL)a2 lastViewedDate:(id)a3 updateThreadScopeManager:(BOOL)a4 connection:(id)a5;
- (id)resetThreadScopesForDeactivatedAccount:(id)a0;
- (void)persistenceIsAddingMailboxWithDatabaseID:(long long)a0 objectID:(id)a1 generationWindow:(id)a2;
- (id)_addedMailboxObjectIDsForActivatedAccount:(id)a0;
- (unsigned long long)persistenceStateForThreadScope:(id)a0;
- (id)_threadScopedToResetForActivatedAccount:(id)a0;
- (void)_addKeyPathsForDisplayMessageChangeToKeyPaths:(id)a0;
- (id)threadScopesByDatabaseID;
- (void)setNeedsUpdateForThreadScope:(id)a0;
- (void)resetThreadScopedForActivatedAccount:(id)a0;
- (void)_enumerateThreadScopesUsingBlock:(id /* block */)a0;
- (id)initWithMessagePersistence:(id)a0 database:(id)a1 hookRegistry:(id)a2 vipManager:(id)a3 blockedSenderManager:(id)a4;
- (void)_persistenceIsChangingFlags:(id)a0 messages:(id)a1 generationWindow:(id)a2;
- (id)_threadDatabaseIDExpressionForThreadScopeDatabaseID:(long long)a0 conversation:(long long)a1;
- (id)_senderDatabaseIDsAndDatesForThreadWithObjectID:(id)a0;
- (id)nextExistingThreadObjectIDForThreadObjectID:(id)a0 forSortDescriptors:(id)a1 excluding:(id)a2;
- (id)_deleteWrappedMessages:(id)a0 fromThreadWithObjectID:(id)a1 threadScopeDatabaseID:(long long)a2 generationWindow:(id)a3;
- (void).cxx_destruct;
- (id)_flagColorsFromRow:(id)a0;
- (id)_updateThreadForDeleteWithObjectID:(id)a0 threadScopeDatabaseID:(long long)a1 generationWindow:(id)a2;
- (id)_recalculateDisplayMessageForThreadObjectID:(id)a0 threadScopeDatabaseID:(long long)a1;
- (id)_statementForOldestThreadInMailbox:(id)a0 threadScope:(id)a1 createMailboxDatabaseIDIfNecessary:(BOOL)a2;
- (id)_recipientDatabaseIDsAndDatesForMessages:(id)a0 recipientType:(unsigned long long)a1;
- (id)_nonJournaledSubjectForThreadWithObjectID:(id)a0 connection:(id)a1;
- (id)_messageThreadExpressionForThreadScope:(id)a0 objectIDs:(id)a1;
- (void)persistenceDidDeleteMessages:(id)a0 generationWindow:(id)a1;
- (id)_countMessagesForExpression:(id)a0;
- (void)verifyConsistencyOfThreadScope:(id)a0;
- (id)_messageFilterExpressionForFilterPredicate:(id)a0;
- (id)_threadQueryForThreadScope:(id)a0;
- (id)statisticsForThreadScopesWithDatabaseIDs:(id)a0;
- (id)_recipientsOfType:(unsigned long long)a0 forThreadDatabaseID:(id)a1;
- (id)_comparisonExpressionForSortDescriptors:(id)a0 conversationID:(long long)a1 threadExpression:(id)a2 threadScopeDatabaseID:(long long)a3 connection:(id)a4;
- (id)_mailboxDatabaseIDsForWrappedMessages:(id)a0;
- (id)_expressionForThreadScope:(id)a0;
- (BOOL)_deleteRecipientsOfType:(unsigned long long)a0 fromThreadWithDatabaseID:(id)a1 messageThreadExpression:(id)a2;
- (void)resetThreadScopesForMailboxScope:(id)a0;
- (BOOL)_recalculateNewestReadMessageForThreadObjectID:(id)a0 threadScopeDatabaseID:(long long)a1;
- (void)persistenceIsDeletingAllMessagesInMailboxWithURL:(id)a0 generationWindow:(id)a1;
- (BOOL)addThreads:(id)a0;
- (id)_sendersForThreadDatabaseID:(id)a0;
- (BOOL)threadScopeManager:(id)a0 evictThreadScopesWithDatabaseIDs:(id)a1 completionBlock:(id /* block */)a2;
- (BOOL)threadScopeManager:(id)a0 isValidMailboxObjectID:(id)a1;
- (id)_wrappedMessagesByThreadScopeForPersistedMessages:(id)a0;
- (id /* block */)threadScopeMatcherForActivatedAccount:(id)a0;
- (id)_senderAddressesExpressionForMessages:(id)a0;
- (id)_wrappedMessageForPersistedMessages:(id)a0 threadScope:(id)a1;
- (id)_messageThreadExpressionForThreadObjectID:(id)a0;
- (BOOL)_addThreadScopeToDatabaseWithMailboxType:(id)a0 needsUpdate:(BOOL)a1 lastViewedDate:(id)a2 connection:(id)a3;
- (id)_recipientsOfType:(unsigned long long)a0 fromMessagesForThreadObjectID:(id)a1;
- (void)persistenceDidAddMessages:(id)a0 generationWindow:(id)a1;
- (id)threadForObjectID:(id)a0 originatingQuery:(id)a1 error:(id *)a2;
- (id)_addressesFromMessageAddressesStatement:(id)a0;
- (void)persistenceIsDeletingMessages:(id)a0 generationWindow:(id)a1;
- (BOOL)beginMigratingThreadScope:(id)a0;
- (id)_sendersFromMessagesForThreadObjectID:(id)a0;
- (id)_messageMailboxesExpressionForMailboxScope:(id)a0;
- (long long)_databaseIDForThreadObjectID:(id)a0;
- (BOOL)addThreadScopeToDatabase:(id)a0 needsUpdate:(BOOL)a1 lastViewedDate:(id)a2;
- (BOOL)_messagesAreJournaledForThreadWithObjectID:(id)a0;
- (id)_threadExpressionForThreadScopeDatabaseID:(long long)a0 conversation:(long long)a1;
- (void)persistenceIsAddingMessages:(id)a0 journaled:(BOOL)a1 generationWindow:(id)a2;
- (id)_messageThreadExpressionForThreadScope:(id)a0 conversationExpression:(id)a1;
- (void)_getIndividualMailboxScopes:(id *)a0 unifiedMailboxThreadScopes:(id *)a1 forAccount:(id)a2;
- (void)threadObjectIDsForThreadScope:(id)a0 sortDescriptors:(id)a1 initialBatchSize:(unsigned long long)a2 journaledObjectIDs:(id)a3 batchBlock:(id /* block */)a4;
- (void)_addPersistedMessages:(id)a0 journaled:(BOOL)a1 generationWindow:(id)a2;

@end
