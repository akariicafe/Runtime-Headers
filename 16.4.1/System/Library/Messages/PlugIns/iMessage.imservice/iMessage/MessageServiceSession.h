@class IMDMessageStore, NSMutableDictionary, IMDCKUtilities, NSString, IMTimer, NSMutableArray, IMDCallManager;

@interface MessageServiceSession : IMDAppleServiceSession <MessagePushHandlerListener, IDSServiceDelegate, MessageDeliveryControllerDelegate> {
    NSMutableArray *_messagePushHandlers;
    IMTimer *_resetFailureRetriesTimer;
    NSMutableDictionary *_failureMap;
    BOOL _networkOverride;
    NSMutableArray *_pendingSendBlockQueue;
}

@property (retain, nonatomic) IMDMessageStore *messageStore;
@property (retain, nonatomic) IMDCKUtilities *ckUtilities;
@property (retain, nonatomic) NSMutableDictionary *pendingGroupPhotoDownloads;
@property (readonly, nonatomic) IMDCallManager *callManager;
@property (readonly) unsigned long long hash;
@property (readonly) Class superclass;
@property (readonly, copy) NSString *description;
@property (readonly, copy) NSString *debugDescription;

- (void)scheduleTransactionLogTask:(id)a0;
- (id)chatStore;
- (void)removeAccount:(id)a0;
- (void)preWarm;
- (void)addAccount:(id)a0;
- (void)_engroupForChat:(id)a0 idsAccount:(id)a1 completion:(id /* block */)a2;
- (void)_handleInitiateHighQualityDownload:(id)a0;
- (void)invitePersonInfoToiMessageChat:(id)a0 withMessage:(id)a1 toChat:(id)a2 style:(unsigned char)a3;
- (id)initWithAccount:(id)a0 service:(id)a1;
- (id)fileTransferDictionaryForChat:(id)a0;
- (void)_resetTransferToTapDownloadState:(id)a0;
- (id)fallBackBizIDSAccount;
- (id)idsAccountForFromURI:(id)a0 toURI:(id)a1;
- (void)sendBalloonPayload:(id)a0 attachments:(id)a1 withMessageGUID:(id)a2 bundleID:(id)a3;
- (void)sessionWillBecomeInactiveWithAccount:(id)a0;
- (void)refreshRegistration;
- (void)handler:(id)a0 payloadDataRequest:(id)a1;
- (id)_URIsFromHandles:(id)a0;
- (void)stageMessageWrapperBlock:(id)a0;
- (void)sessionDidBecomeActive;
- (void)leaveChat:(id)a0 style:(unsigned char)a1;
- (id)getMessageDeliveryController;
- (unsigned long long)_computeFlagsForIncomingMessage:(unsigned long long)a0 isFromMe:(BOOL)a1 unfinished:(BOOL)a2 isAudioMessage:(BOOL)a3 isAutoReply:(BOOL)a4 isExpirable:(BOOL)a5 messageSource:(unsigned long long)a6 participants:(id)a7 hasUnseenMention:(BOOL)a8;
- (void)joinChat:(id)a0 handleInfo:(id)a1 style:(unsigned char)a2 groupID:(id)a3 lastAddressedHandle:(id)a4 lastAddressedSIMID:(id)a5 joinProperties:(id)a6;
- (id)callerURI;
- (void)_sendHighResolutionImagesForMessage:(id)a0 fromID:(id)a1 fromAccount:(id)a2 toURIs:(id)a3 toChat:(id)a4;
- (void)updateDisplayName:(id)a0 fromDisplayName:(id)a1 forChatID:(id)a2 identifier:(id)a3 style:(unsigned char)a4;
- (void)sendLocationSharingInfo:(id)a0 toID:(id)a1 completionBlock:(id /* block */)a2;
- (void)_setWeeklyFailureResetTimer;
- (void)handler:(id)a0 genericNotification:(id)a1 incomingMessage:(id)a2 userInfo:(id)a3 toIdentifier:(id)a4 fromIdentifier:(id)a5 fromToken:(id)a6 timeStamp:(id)a7 fromIDSID:(id)a8 needsDeliveryReceipt:(id)a9 deliveryContext:(id)a10 storageContext:(id)a11;
- (void)doneRetrievingAttachmentsForGroupPhotoForChat:(id)a0 fileTransferError:(id)a1 success:(BOOL)a2 transferGuid:(id)a3 sender:(id)a4 isHidden:(BOOL)a5;
- (void)_forwardP2PGroupCommand:(id)a0 fromPerson:(id)a1 toPerson:(id)a2 toGroup:(id)a3 toToken:(id)a4;
- (BOOL)_shouldOptimizedDeliveryRecieptForConversation:(id)a0 withMessageTimeStamp:(id)a1;
- (double)_messageRetryTimeout;
- (unsigned long long)capabilities;
- (BOOL)_isFromLinkedID:(id)a0 fromID:(id)a1;
- (void)sendSavedReceiptForMessage:(id)a0 toChatID:(id)a1 identifier:(id)a2 style:(unsigned char)a3;
- (BOOL)_isRegisteredURI:(id)a0;
- (void)handler:(id)a0 messageIDDelivered:(id)a1 toIdentifier:(id)a2 status:(id)a3 deliveryContext:(id)a4 timeStamp:(id)a5 fromIDSID:(id)a6 needsDeliveryReceipt:(id)a7 deliveryContext:(id)a8 storageContext:(id)a9;
- (void)sendSyndicationAction:(id)a0 toChatsWithIdentifiers:(id)a1;
- (BOOL)_amIMentioned:(id)a0 inMentions:(id)a1;
- (void)_checkGlobalReadReceiptValueAndUpdateIfNeeded:(id)a0;
- (id)getMessageAttachmentController;
- (void)processNetworkDataAvailabilityChange:(BOOL)a0;
- (void)sendNotifyRecipientCommandForMessage:(id)a0 toChatGuid:(id)a1 identifier:(id)a2 style:(unsigned char)a3;
- (void)requestGroupPhotoIfNecessary:(id)a0 incomingGroupPhotoCreationTime:(id)a1 toIdentifier:(id)a2 fromIdentifier:(id)a3 messageIsFromStorage:(BOOL)a4;
- (void)handler:(id)a0 messageIDReflectedDelivered:(id)a1 incomingMessage:(id)a2 toIdentifier:(id)a3 fromIdentifier:(id)a4 status:(id)a5 deliveryContext:(id)a6 timeStamp:(id)a7 fromIDSID:(id)a8 needsDeliveryReceipt:(id)a9 deliveryContext:(id)a10 storageContext:(id)a11;
- (void)updateBalloonPayload:(id)a0 attachments:(id)a1 forMessageGUID:(id)a2;
- (void)_nicknameFetchCompletedMessage:(id)a0 synchronous:(BOOL)a1 isEncrypted:(BOOL)a2 profile:(id)a3 nickNameWasInCache:(BOOL)a4 nickNameDownloadError:(id)a5;
- (unsigned long long)_failuresForID:(id)a0;
- (void)sendGroupPhotoUpdate:(id)a0 toChatID:(id)a1 identifier:(id)a2 style:(unsigned char)a3 account:(id)a4;
- (id)_messageDictionaryForDeleteCommandShouldResetPreference:(BOOL)a0;
- (BOOL)networkConditionsAllowLogin;
- (void)_blastDoorProcessingWithIMMessageItem:(id)a0 chat:(id)a1 account:(id)a2 fromToken:(id)a3 fromIDSID:(id)a4 fromIdentifier:(id)a5 toIdentifier:(id)a6 participants:(id)a7 groupName:(id)a8 groupID:(id)a9 isEncrypted:(BOOL)a10 isFromMe:(BOOL)a11 isLastFromStorage:(BOOL)a12 isFromStorage:(BOOL)a13 hideLockScreenNotification:(BOOL)a14 wantsCheckpointing:(BOOL)a15 needsDeliveryReceipt:(id)a16 messageBalloonPayloadAttachmentDictionary:(id)a17 inlineAttachments:(id)a18 attributionInfoArray:(id)a19 nicknameDictionary:(id)a20 availabilityVerificationRecipientChannelIDPrefix:(id)a21 availabilityVerificationRecipientEncryptionValidationToken:(id)a22 messageContext:(id)a23 isFromTrustedSender:(BOOL)a24 completionBlock:(id /* block */)a25;
- (void)handler:(id)a0 locationShareInfo:(id)a1 toIdentifier:(id)a2 fromIdentifier:(id)a3 fromToken:(id)a4 timeStamp:(id)a5 fromIDSID:(id)a6 needsDeliveryReceipt:(id)a7 deliveryContext:(id)a8 storageContext:(id)a9;
- (void)handler:(id)a0 recoverCommand:(id)a1 toIdentifier:(id)a2 fromIdentifier:(id)a3 fromToken:(id)a4 timeStamp:(id)a5 fromIDSID:(id)a6 needsDeliveryReceipt:(id)a7 deliveryContext:(id)a8 storageContext:(id)a9;
- (void)handler:(id)a0 updateAttachments:(id)a1 toIdentifier:(id)a2 fromIdentifier:(id)a3 fromToken:(id)a4 timeStamp:(id)a5 fromIDSID:(id)a6 needsDeliveryReceipt:(id)a7 deliveryContext:(id)a8 storageContext:(id)a9 fileTransferUpdates:(id)a10;
- (void)handler:(id)a0 messageIDPlayed:(id)a1 toIdentifier:(id)a2 fromIdentifier:(id)a3 fromToken:(id)a4 timeStamp:(id)a5 fromIDSID:(id)a6 needsDeliveryReceipt:(id)a7 deliveryContext:(id)a8 storageContext:(id)a9;
- (void)messageDeliveryController:(id)a0 serverUpdatedTimestampMessage:(id)a1;
- (BOOL)_transferIsValidForServiceSession:(id)a0;
- (id)pendingSendBlockQueue;
- (void)retryGroupPhotoUpload:(id)a0 toChatID:(id)a1 identifier:(id)a2 style:(unsigned char)a3 account:(id)a4;
- (void)leaveiMessageChat:(id)a0 style:(unsigned char)a1;
- (id)bizIDSAccountFromMadridIDSAccount:(id)a0;
- (void)handler:(id)a0 remoteFileRequest:(id)a1;
- (void)sendCommand:(id)a0 withProperties:(id)a1 toPerson:(id)a2;
- (BOOL)shouldUploadGroupPhoto:(id)a0;
- (void)_updateKeepMessagesPrefWithNumberOfDays:(long long)a0 verison:(long long)a1;
- (void)_updateChatProperties:(id)a0 withProperties:(id)a1;
- (BOOL)_shouldBlackholeGroupChatFromSender:(id)a0 toRecipient:(id)a1 withOtherParticipants:(id)a2 forAccount:(id)a3;
- (void)_updateTransfersForAttributionInfoArray:(id)a0 message:(id)a1;
- (id)getMessagePushHandlers;
- (void)sendCommand:(id)a0 withProperties:(id)a1 toPerson:(id)a2 toChatID:(id)a3 identifier:(id)a4 style:(unsigned char)a5;
- (void)handler:(id)a0 remoteFileResponse:(id)a1;
- (void)handler:(id)a0 messageIDSaved:(id)a1 ofType:(id)a2 toIdentifier:(id)a3 fromIdentifier:(id)a4 groupContext:(id)a5 fromToken:(id)a6 timeStamp:(id)a7 fromIDSID:(id)a8 needsDeliveryReceipt:(id)a9 deliveryContext:(id)a10 storageContext:(id)a11;
- (id)getStickerRefreshDeliveryController;
- (id)idsServiceForIDSAccount:(id)a0;
- (void)sendDeleteCommand:(id)a0 forChatGUID:(id)a1;
- (void)sendEditedMessage:(id)a0 previousMessage:(id)a1 partIndex:(long long)a2 editType:(unsigned long long)a3 toChatIdentifier:(id)a4 style:(unsigned char)a5 account:(id)a6 backwardCompatabilityText:(id)a7;
- (void)sendNicknameInfoToChatID:(id)a0;
- (void)handler:(id)a0 bubblePayloadData:(id)a1 forMessageID:(id)a2 toIdentifier:(id)a3 fromIdentifier:(id)a4 fromToken:(id)a5 timeStamp:(id)a6 fromIDSID:(id)a7 needsDeliveryReceipt:(id)a8 deliveryContext:(id)a9 storageContext:(id)a10;
- (BOOL)_enableReadReceiptForChat:(id)a0 style:(unsigned char)a1;
- (void)_fixParticipantsForChat:(id)a0;
- (void)handler:(id)a0 nicknameInfoReceived:(id)a1 userInfo:(id)a2 toIdentifier:(id)a3 fromIdentifier:(id)a4 fromToken:(id)a5 timeStamp:(id)a6 fromIDSID:(id)a7 needsDeliveryReceipt:(id)a8 deliveryContext:(id)a9 storageContext:(id)a10;
- (BOOL)_sendCertifiedDeliveryReceiptIfPossible:(id)a0 messageContext:(id)a1 guid:(id)a2 messageWasStored:(BOOL)a3 needsDeliveryReceipt:(BOOL)a4 failureReason:(id)a5;
- (void)eagerUploadTransfer:(id)a0 recipients:(id)a1;
- (void)refreshServiceCapabilities;
- (void)_handleMessageSentToSelf:(id)a0 chatIdentifier:(id)a1 style:(unsigned char)a2 isLocal:(BOOL)a3 account:(id)a4;
- (unsigned long long)_maxFailuresAllowed;
- (id)storeBreadcrumbAndSetConsumedPayloadsForNewMessageItemIfNecessary:(id)a0 inChatWithIdentifier:(id)a1;
- (id)callerURIUsingCalleeURI:(id)a0;
- (void)handler:(id)a0 incomingMessage:(id)a1 originalEncryptionType:(id)a2 messageID:(id)a3 toIdentifier:(id)a4 fromIdentifier:(id)a5 fromToken:(id)a6 timeStamp:(id)a7 fromIDSID:(id)a8 incomingEngroup:(id)a9 needsDeliveryReceipt:(id)a10 deliveryContext:(id)a11 storageContext:(id)a12 messageContext:(id)a13 isBeingReplayed:(BOOL)a14 mergeID:(id)a15 wantsCheckpointing:(BOOL)a16;
- (void)sendPlayedReceiptForMessage:(id)a0 toChatID:(id)a1 identifier:(id)a2 style:(unsigned char)a3;
- (void)_sendSyndicationAction:(id)a0 toChat:(id)a1;
- (void)_incrementDecryptionFailureForID:(id)a0;
- (void)groupPhotoDownloadCompletedForChat:(id)a0 fileTransferError:(id)a1 success:(BOOL)a2 transferGuid:(id)a3 sender:(id)a4 isHidden:(BOOL)a5;
- (void)setMessagePushHandlers:(id)a0;
- (void)_updateGlobalReadReceiptValue:(BOOL)a0 withVersionID:(id)a1;
- (BOOL)_isAllowlistedUnencryptedSender:(id)a0;
- (void)_logLocalInfo;
- (void)_handleNicknameReceived:(id)a0 fromIdentifier:(id)a1 isEncrypted:(BOOL)a2 withMessageItem:(id)a3;
- (void)sendLogDumpMessageAtFilePath:(id)a0 toRecipient:(id)a1 shouldDeleteFile:(BOOL)a2 withCompletion:(id /* block */)a3;
- (void)handler:(id)a0 payloadDataResponse:(id)a1;
- (BOOL)_shouldIgnoreMessageFromSender:(id)a0 balloonBID:(id)a1 fromMe:(BOOL)a2;
- (void)receivedGroupPhotoUpdate:(id)a0 chat:(id)a1 sender:(id)a2 isHidden:(BOOL)a3;
- (void)_UpdateLastAddressedSIMIDForOtherServicesIfNeededWithChatIdentifier:(id)a0 style:(unsigned char)a1;
- (void)uploadGroupPhotoForChat:(id)a0 fileTransferGUID:(id)a1 itemGUID:(id)a2 callerURI:(id)a3 idsAccount:(id)a4;
- (void)_handleFileTransferAccepted:(id)a0;
- (id)storageController;
- (void)dealloc;
- (void)sendMessage:(id)a0 toChat:(id)a1 style:(unsigned char)a2;
- (void)sendRecoverCommand:(id)a0 forChatGUID:(id)a1;
- (void)removePersonInfo:(id)a0 chatID:(id)a1 identifier:(id)a2 style:(unsigned char)a3;
- (BOOL)shouldDownloadGroupPhoto:(id)a0;
- (void)addItemToRecentsIfApplicable:(id)a0;
- (id)_messageItemToConsumeForNewBreadcrumbMessage:(id)a0 outBreadcrumbItems:(id *)a1;
- (BOOL)_updateReadReceiptProperties:(id)a0 withIncomingProperties:(id)a1;
- (void)enqueReplayMessageCallback:(id /* block */)a0;
- (void)invitePersonInfo:(id)a0 withMessage:(id)a1 toChat:(id)a2 style:(unsigned char)a3;
- (unsigned int)messageServiceTypeForURI:(id)a0;
- (void)groupPhotoUploadCompletedForChat:(id)a0 fileTransferGuid:(id)a1 callerURI:(id)a2 fromAccount:(id)a3 message:(id)a4 displayIDs:(id)a5 additionalContext:(id)a6 success:(BOOL)a7 error:(unsigned int)a8;
- (BOOL)overrideNetworkAvailability;
- (BOOL)canMakeExpireStateChecks;
- (BOOL)reflectRecoverChatToPeerDevicesForMessageGUID:(id)a0;
- (BOOL)_richLinkPendSendingWithGUID:(id)a0;
- (BOOL)_originalTimestampWithinAcceptableWindow:(id)a0 timestamp:(id)a1;
- (void)sendReadReceiptForMessage:(id)a0 toChatID:(id)a1 identifier:(id)a2 style:(unsigned char)a3;
- (id)_handleIDsForDestinations:(id)a0;
- (void)handler:(id)a0 receivedError:(id)a1 forMessageID:(id)a2 toIdentifier:(id)a3 fromIdentifier:(id)a4 fromToken:(id)a5 timeStamp:(id)a6 fromIDSID:(id)a7 needsDeliveryReceipt:(id)a8 deliveryContext:(id)a9 storageContext:(id)a10 additionalInfo:(id)a11 shouldShowPeerErrors:(BOOL)a12;
- (BOOL)sendNicknameUpdatesToPeerDevices:(id)a0 toDestinations:(id)a1;
- (void)_handleDeleteCommandWithMessageDictionary:(id)a0;
- (void)_flushQueuedMessageWrapperBlocks;
- (void)_autoReportChatAsUnknown:(id)a0 chatIsNew:(BOOL)a1;
- (void)groupPhotoUploadFailedForChat:(id)a0 fileTransferGuid:(id)a1;
- (double)_richLinkDelayTimeInterval;
- (id)_firstiMessageChat;
- (id)_messageDictionaryToReflectWithDeliveryReceipt:(id)a0;
- (void)joinChat:(id)a0 handleInfo:(id)a1 style:(unsigned char)a2 groupID:(id)a3 lastAddressedHandle:(id)a4 joinProperties:(id)a5;
- (void)messageDeliveryController:(id)a0 service:(id)a1 didFlushCacheForRemoteURI:(id)a2 fromURI:(id)a3 guid:(id)a4;
- (void)_enqueueBlock:(id /* block */)a0 withTimeout:(double)a1 description:(id)a2;
- (id)callerURIForMessageServiceType:(unsigned int)a0;
- (void)requestProperty:(id)a0 ofPerson:(id)a1;
- (id)getMessageGroupController;
- (void)handler:(id)a0 groupMessageCommand:(id)a1 encryptedGroupCommand:(id)a2 toIdentifier:(id)a3 fromIdentifier:(id)a4 fromToken:(id)a5 timeStamp:(id)a6 fromIDSID:(id)a7 needsDeliveryReceipt:(id)a8 deliveryContext:(id)a9 storageContext:(id)a10;
- (BOOL)_shouldBlackholeChatFromSender:(id)a0 toRecipient:(id)a1 forAccount:(id)a2;
- (void)sendUpdatedCollaborationMetadata:(id)a0 toChatsWithIdentifiers:(id)a1 forMessageGUID:(id)a2;
- (void)fallbackToMMCSIfPossible:(id)a0 transfer:(id)a1;
- (void)_updateLocalReadReceiptValueWithGlobalValue:(BOOL)a0;
- (BOOL)_shouldAdjustTimestampOfResentMessages;
- (void)closeSessionChat:(id)a0 style:(unsigned char)a1;
- (void)_forwardP2PGroupCommand:(id)a0 fromPerson:(id)a1 toPerson:(id)a2 toGroup:(id)a3;
- (void)_updateNetworkOverride;
- (void)_handleFileTransferBatchAccepted:(id)a0;
- (BOOL)reflectMarkUnreadToPeerDevicesForMessageGUID:(id)a0;
- (void)eagerUploadCancel:(id)a0;
- (void)joinChat:(id)a0 handleInfo:(id)a1 style:(unsigned char)a2 groupID:(id)a3 joinProperties:(id)a4;
- (void)_iMessageBagLoaded:(id)a0;
- (id)_pushHandlerForIDSAccount:(id)a0;
- (void)_reAttemptMessageDeliveryForGUID:(id)a0 toIdentifier:(id)a1 fromIdentifier:(id)a2 fromIDSID:(id)a3 isReflection:(BOOL)a4 shouldShowError:(BOOL)a5 cacheFlushError:(BOOL)a6 imdAccount:(id)a7;
- (void)handler:(id)a0 deleteCommand:(id)a1 toIdentifier:(id)a2 fromIdentifier:(id)a3 fromToken:(id)a4 timeStamp:(id)a5 fromIDSID:(id)a6 needsDeliveryReceipt:(id)a7 deliveryContext:(id)a8 storageContext:(id)a9;
- (void)handler:(id)a0 messageIDRead:(id)a1 toIdentifier:(id)a2 fromIdentifier:(id)a3 fromToken:(id)a4 timeStamp:(id)a5 fromIDSID:(id)a6 needsDeliveryReceipt:(id)a7 deliveryContext:(id)a8 storageContext:(id)a9;
- (id)generateAndStoreGroupPhotoChangeStatusItemForChat:(id)a0 sender:(id)a1 fileTransferGuid:(id)a2 isHidden:(BOOL)a3;
- (void)removePersonInfoFromiMessageChat:(id)a0 chatID:(id)a1 identifier:(id)a2 style:(unsigned char)a3;
- (void)transferUpdated:(id)a0;
- (void)sendDeliveredQuietlyReceiptForMessage:(id)a0 forIncomingMessageFromIDSID:(id)a1 toChatGuid:(id)a2 identifier:(id)a3 style:(unsigned char)a4 withWillSendToDestinationsHandler:(id /* block */)a5;
- (void)sendDeliveryReceiptForMessageID:(id)a0 toID:(id)a1 deliveryContext:(id)a2 needsDeliveryReceipt:(id)a3 callerID:(id)a4 account:(id)a5;
- (void)_automation_sendDictionary:(id)a0 options:(id)a1 toHandles:(id)a2;
- (void)replayMessage:(id)a0;
- (BOOL)_ckAssetDownloadCanFallBackToMMCSForTransfer:(id)a0;
- (void)joinChat:(id)a0 handleInfo:(id)a1 style:(unsigned char)a2 joinProperties:(id)a3;
- (BOOL)didReceiveMessages:(id)a0 forChat:(id)a1 style:(unsigned char)a2 account:(id)a3 fromIDSID:(id)a4;
- (void)_resetFailureRetries;
- (void)forwardDeliveryReceiptForMessageID:(id)a0 withAccount:(id)a1 callerURI:(id)a2;

@end
